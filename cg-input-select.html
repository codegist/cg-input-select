<link rel="import" href="../polymer/polymer.html" >
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../paper-item/paper-item.html">

<dom-module id="cg-input-select">
<style>
    .wrapper {
        @apply(--layout-relative)
    }
    .wrapper .input {
        @apply(--paper-font-body1);
        text-transform: none;
    }
    .wrapper #select {
        position:absolute;
        z-index: 1;
        outline: 0;
    }
    .wrapper #menu {
        @apply(--paper-font-body1);
    }
    .wrapper paper-material {
        max-height:200px;
        overflow:auto;
        padding:5px;
    }
    .wrapper #select .item {
        @apply(--paper-font-body1);
    }
    .wrapper #select .item.iron-selected {
        font-weight: bold!important;
    }
</style>
<template>
    <div class="wrapper">
        <paper-button on-tap="_toggle" class="input"><span>[[displayLabel(selected)]]</span><iron-icon icon="arrow-drop-down"></iron-icon></paper-button>
        <iron-collapse id="select">
            <paper-material>
                <paper-menu id="menu" selected="{{value}}" attr-for-selected="value">
                    <template is="dom-repeat" items="[[list]]" as="item">
                        <paper-item class="item" value$="[[item.value]]">[[displayLabel(item)]]</paper-item>
                    </template>
                </paper-menu>
            </paper-material>
        </iron-collapse>
    </div>
</template>
</dom-module>
<script>
    Polymer({
        is:"cg-input-select",
        properties:{
            label:String,
            list:Array,
            required:{
                type:Boolean,
                value:false,
            },
            value:{
                type:String,
                observer:'valueChanged'
            },
            selected:{
                computed:'computeSelected(list, value)'
            },
        },
        attached:function(){
            document.addEventListener("click", this._documentClick.bind(this));
        },
        detached:function(){
            document.removeEventListener("click", this._documentClick.bind(this));
        },
        _toggle:function(){
            this.$.select.toggle();
        },
        _documentClick:function(e){
            var clickLocation = e.target;
            while(clickLocation != null && clickLocation != this) clickLocation = clickLocation.parentElement;
            if(clickLocation == this) return;
            if(this.$.select.opened){
                this.$.select.opened = false;
            }
        },
        displayLabel:function(value){
            if(!value) return "";
            return value.label || value.value;
        },
        computeSelected:function(list, value){
            if(this.list) {
                for(var i = 0; i < list.length; i++) {
                    if(list[i].value == value) {
                        return list[i];
                    }
                }
            }
            return null;
        },
        valueChanged:function(){
            this.$.select.opened = false;
        },
    });
</script>