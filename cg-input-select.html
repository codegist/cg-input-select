<link rel="import" href="../polymer/polymer.html" >
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../cg-base/cg-required-validator.html">
<link rel="import" href="../cg-base/cg-validatable-behavior.html">
<link rel="import" href="../cg-utils/cg-utilities-behavior.html">
<link rel="import" href="../cg-dropdown/cg-dropdown.html">

<dom-module id="cg-input-select">
<style>
    :host(:not(.selected)) .input span {
        color:#6A6A6A;
    }
    .wrapper .input {
        @apply(--paper-font-body1);
        text-transform: none;
        line-height:inherit!important;
    }
    .wrapper .input ::content paper-material,
    .wrapper .input {
        padding:0px;
        margin:0px;
    }
    .wrapper .input .content {
        @apply(--layout-horizontal);
    }
    .wrapper #menu {
        @apply(--paper-font-body1);
    }
    .wrapper #dd ::content #dd_wrapper {
        max-height:200px;
        overflow:auto;
    }
    .wrapper .item {
        @apply(--paper-font-body1);
        cursor: pointer;
        white-space: nowrap;
    }
    .wrapper .item.iron-selected {
        font-weight: bold!important;
    }
</style>
<template>
    <div class="wrapper">
        <cg-required-validator required="[[required]]"></cg-required-validator>
        <paper-button on-tap="_toggleDD" class="input">
            <div class="content"><div>[[firstPropFoundOrDefault(selected, label, labelPropPath, valuePropPath)]]</div><iron-icon icon="arrow-drop-down"></iron-icon></div>
        </paper-button>
        <cg-dropdown id="dd" owner-target="[[_self]]">
            <paper-menu dd-content id="menu" selected="{{value}}" attr-for-selected="value">
                <template is="dom-repeat" items="[[list]]" as="item">
                    <paper-item class="item" value$="[[get(valuePropPath, item)]]">[[firstPropFound(item, labelPropPath, valuePropPath)]]</paper-item>
                </template>
            </paper-menu>
        </cg-dropdown>
    </div>
</template>
</dom-module>
<script>
    Polymer({
        is:"cg-input-select",
        properties:{
            list:{
                type:Array,
                value:null
            },
            required:{
                type:Boolean,
                value:false,
            },
            value:{
                type:String,
                value:null,
                notify:true,
                observer:'_selection'
            },
            valuePropPath:{
                type:String,
                value:"value",
            },
            labelPropPath:{
                type:String,
                value:"label",
            },
            label:{
                type:String,
                value:"Select an item",
                observer:"changgggg",
            },
            validator: {
                type: String,
                value: 'cg-required-validator'
            },
            selected: {
                computed:'computeSelected(list, value, label)'
            },
            _self:{
                type:Element,
                value:function(){return this;}
            },
        },
        behaviors:[CG.ValidatableBehavior, CG.UtilitiesBehavior],
        _toggleDD:function(e){
            this.$.dd.toggle();
        },
        _openDD:function(e){
            this.$.dd.open();
        },
        _closeDD:function(e){
            this.$.dd.close();
        },
        changgggg:function(e){
            console.log()
        },
        computeSelected:function(list, value){
            if(list) {
                for(var i = 0; i < list.length; i++) {
                    if(this.get(this.valuePropPath, list[i]) == value) {
                        return list[i];
                    }
                }
            }
            return null;
        },
        _selection:function(){
            this._closeDD();
            this.toggleClass("selected", this.selected != null, this);
            this.fire("input", this.selected);
        },
    });
</script>