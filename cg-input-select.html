<link rel="import" href="../polymer/polymer.html" >
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../cg-base/cg-required-validator.html">
<link rel="import" href="../cg-base/cg-validatable-behavior.html">
<link rel="import" href="../cg-dropdown/cg-dropdown.html">

<dom-module id="cg-input-select">
<style>
    :host(:not(.selected)) .input span {
        color:#6A6A6A;
    }
    .wrapper .input {
        @apply(--paper-font-body1);
        text-transform: none;
    }
    .wrapper #menu {
        @apply(--paper-font-body1);
    }
    .wrapper paper-material {
        max-height:200px;
        overflow:auto;
        margin:5px;
    }
    .wrapper .item {
        @apply(--paper-font-body1);
        cursor: pointer;
    }
    .wrapper .item.iron-selected {
        font-weight: bold!important;
    }
</style>
<template>
    <div class="wrapper">
        <cg-required-validator required="[[required]]"></cg-required-validator>
        <paper-button on-tap="_toggleDD" class="input"><span>[[displayValueOrLabel(label, selected)]]</span><iron-icon icon="arrow-drop-down"></iron-icon></paper-button>
        <cg-dropdown list="[[list]]" value="{{selected.value}}" id="dd" owner-target="[[_self]]">
            <paper-menu dd-content id="menu" selected="{{value}}" attr-for-selected="value">
                <template is="dom-repeat" items="[[list]]" as="item">
                    <paper-item class="item" value$="[[item.value]]">[[displayLabel(item)]]</paper-item>
                </template>
            </paper-menu>
        </cg-dropdown>
    </div>
</template>
</dom-module>
<script>
    Polymer({
        is:"cg-input-select",
        properties:{
            list:{
                type:Array,
                value:null
            },
            required:{
                type:Boolean,
                value:false,
            },
            value:{
                type:String,
                value:null,
                notify:true,
                observer:'_selection'
            },
            label:{
                type:String,
                value:"Select an item"
            },
            validator: {
                type: String,
                value: 'cg-required-validator'
            },
            selected: {
                computed:'computeSelected(list, value, label)',
            },
            _self:{
                type:Element,
                value:function(){return this;}
            },
        },
        behaviors:[CG.ValidatableBehavior],
        _toggleDD:function(e){
            this.$.dd.toggle();
        },
        _openDD:function(e){
            this.$.dd.open();
        },
        _closeDD:function(e){
            this.$.dd.close();
        },
        displayValueOrLabel:function(label, selected){
            if(!selected) return label;
            return this.displayLabel(selected);
        },
        displayLabel:function(value){
            if(!value) return undefined;
            return value.label || value.value;
        },
        computeSelected:function(list, value){
            if(list) {
                for(var i = 0; i < list.length; i++) {
                    if(list[i].value == value) {
                        return list[i];
                    }
                }
            }
            return null;
        },
        _selection:function(){
            this._closeDD();
            this.toggleClass("selected", this.selected != null, this);
        },
    });
</script>